<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CNEAPEE News+ | Live Intelligence</title>
    
    <!-- Preconnect -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Tailwind & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = { 
            darkMode: 'class', 
            theme: { 
                extend: { 
                    colors: { dark: '#030305' },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.4s ease-out forwards'
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(10px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
                    }
                } 
            } 
        }

        function toggleTheme() { 
            document.documentElement.classList.toggle('dark'); 
            localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        }

        if (localStorage.getItem('theme') === 'light') {
            document.documentElement.classList.remove('dark');
        }
    </script>
    
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        
        .grid-bg { 
            background-image: linear-gradient(rgba(120,120,120,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(120,120,120,0.05) 1px, transparent 1px); 
            background-size: 30px 30px; 
            mask-image: linear-gradient(black 60%, transparent); 
            -webkit-mask-image: linear-gradient(black 60%, transparent);
        }
        
        .spotlight { background: radial-gradient(400px circle at var(--x) var(--y), rgba(100,100,100,0.06), transparent 40%); }
        html.dark .spotlight { background: radial-gradient(500px circle at var(--x) var(--y), rgba(255,255,255,0.03), transparent 40%); }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(156, 163, 175, 0.5); border-radius: 3px; }
    </style>
</head>
<body class="bg-zinc-50 text-zinc-900 dark:bg-[#030305] dark:text-zinc-300 flex flex-col min-h-screen overflow-x-hidden relative transition-colors duration-300"
      onmousemove="requestAnimationFrame(() => document.querySelectorAll('.card').forEach(c=>{const r=c.getBoundingClientRect();c.style.setProperty('--x',(event.clientX-r.left)+'px');c.style.setProperty('--y',(event.clientY-r.top)+'px')}))">

    <!-- Backgrounds -->
    <div class="fixed inset-0 grid-bg pointer-events-none -z-10"></div>
    <div class="fixed top-0 left-1/2 -translate-x-1/2 w-[600px] h-[400px] bg-indigo-500/5 blur-[120px] rounded-full pointer-events-none -z-10"></div>

    <!-- Navigation (Pill Style) -->
    <nav class="fixed top-6 left-0 right-0 z-50 flex justify-center px-4">
        <div class="bg-white dark:bg-zinc-900/90 backdrop-blur-xl border border-zinc-200 dark:border-white/10 rounded-full p-1.5 flex items-center shadow-2xl transition-all duration-300 hover:shadow-indigo-500/10">
            
            <a href="index.html" class="w-10 h-10 flex items-center justify-center rounded-full text-zinc-500 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-white/10 hover:text-zinc-900 dark:hover:text-white transition" title="Home">
                <i class="fas fa-home"></i>
            </a>

            <div class="w-px h-4 bg-zinc-300 dark:bg-white/10 mx-2"></div>

            <div class="relative group">
                <button class="flex items-center gap-3 px-6 py-2 rounded-full bg-zinc-100 dark:bg-white/5 hover:bg-zinc-200 dark:hover:bg-white/10 text-sm font-semibold text-zinc-900 dark:text-white transition cursor-default">
                    <span>News Plus</span>
                    <i class="fas fa-rss text-xs text-indigo-500 animate-pulse"></i>
                </button>
            </div>

            <div class="w-px h-4 bg-zinc-300 dark:bg-white/10 mx-2"></div>

            <button onclick="toggleSettings()" class="w-10 h-10 flex items-center justify-center rounded-full text-zinc-500 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-white/10 hover:text-zinc-900 dark:hover:text-white transition" title="Settings">
                <i class="fas fa-cog"></i>
            </button>
        </div>
    </nav>

    <!-- Settings Panel -->
    <div id="settingsPanel" class="fixed top-20 right-0 left-0 mx-auto w-72 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-white/10 rounded-2xl shadow-2xl p-5 hidden z-40 transform transition-all animate-fade-in">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xs font-bold uppercase text-zinc-500 tracking-wider">Feed Configuration</h3>
            <button onclick="toggleSettings()" class="text-zinc-400 hover:text-zinc-900 dark:hover:text-white"><i class="fas fa-times"></i></button>
        </div>
        
        <div class="mb-4">
            <label class="block text-xs text-zinc-400 mb-1.5">GNews API Key (Required for Live)</label>
            <input type="password" id="apiKeyInput" placeholder="Paste key from gnews.io" class="w-full bg-zinc-100 dark:bg-black/50 border border-zinc-200 dark:border-white/10 rounded-lg px-3 py-2 text-xs text-zinc-900 dark:text-white focus:outline-none focus:border-indigo-500 mb-1">
            <a href="https://gnews.io/" target="_blank" class="text-[10px] text-indigo-500 hover:underline inline-flex items-center gap-1">Get free key <i class="fas fa-external-link-alt"></i></a>
        </div>

        <button onclick="saveKeyAndRefresh()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-bold py-2.5 rounded-lg mb-4 transition shadow-lg shadow-indigo-500/20">
            Save & Connect
        </button>

        <div class="border-t border-zinc-200 dark:border-white/10 pt-4 flex justify-between items-center">
            <span class="text-xs text-zinc-500">Appearance</span>
            <button onclick="toggleTheme()" class="text-xs bg-zinc-100 dark:bg-white/10 px-3 py-1.5 rounded-md hover:bg-zinc-200 dark:hover:bg-white/20 transition text-zinc-700 dark:text-zinc-300">Toggle Theme</button>
        </div>
    </div>

    <main class="flex-grow pt-32 pb-20 px-4 max-w-7xl mx-auto w-full">
        
        <!-- Status Header -->
        <div class="flex flex-col items-center justify-center mb-12 animate-fade-in text-center">
            <div id="statusBadge" class="inline-flex items-center gap-2 mb-4 px-3 py-1 rounded-full border border-indigo-500/20 bg-indigo-500/5 text-indigo-600 dark:text-indigo-400 text-xs font-mono">
                <span class="w-2 h-2 rounded-full bg-indigo-500 animate-pulse"></span>
                <span id="statusText">SIMULATION MODE</span>
            </div>
            
            <h1 class="text-3xl md:text-4xl font-bold tracking-tight mb-2 text-zinc-900 dark:text-white">
                Live Intelligence Feed
            </h1>
            
            <div class="flex items-center gap-3 text-sm text-zinc-500 dark:text-zinc-400 bg-zinc-100 dark:bg-white/5 px-5 py-2 rounded-xl border border-zinc-200 dark:border-white/5 mt-4">
                <i class="fas fa-clock text-zinc-400 animate-pulse"></i>
                <span class="font-medium">Next Auto-Update:</span>
                <span id="countdown" class="font-mono font-bold text-zinc-900 dark:text-white tabular-nums tracking-wide">--:--</span>
            </div>
        </div>

        <!-- News Grid -->
        <div id="newsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="col-span-full text-center py-20 text-zinc-500 animate-pulse">Initializing News Engine...</div>
        </div>

    </main>

    <!-- Article Modal -->
    <div id="articleBanner" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <div id="bannerBackdrop" class="absolute inset-0 bg-black/80 backdrop-blur-sm transition-opacity opacity-0" onclick="closeBanner()"></div>
        <div class="banner-content relative w-full max-w-2xl bg-white dark:bg-[#0A0A0C] border border-zinc-200 dark:border-white/10 rounded-3xl shadow-2xl flex flex-col max-h-[85vh] transform scale-95 opacity-0 transition-all duration-300">
            
            <div class="flex justify-between items-start p-6 border-b border-zinc-100 dark:border-white/5 bg-zinc-50/50 dark:bg-zinc-900/50 rounded-t-3xl">
                <div>
                    <span id="modalSource" class="text-xs font-bold uppercase tracking-wider text-zinc-500 mb-2 block">Source</span>
                    <h2 id="bannerTitle" class="text-xl font-bold text-zinc-900 dark:text-white leading-tight"></h2>
                </div>
                <button onclick="closeBanner()" class="w-8 h-8 rounded-full bg-zinc-100 dark:bg-white/5 hover:bg-zinc-200 dark:hover:bg-white/10 flex items-center justify-center transition text-zinc-500 dark:text-zinc-400 flex-shrink-0 ml-4">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="bannerContent" class="p-6 md:p-8 overflow-y-auto text-zinc-600 dark:text-zinc-300 leading-relaxed space-y-4 custom-scrollbar text-base">
            </div>
            
            <div class="p-4 border-t border-zinc-100 dark:border-white/5 bg-zinc-50/50 dark:bg-zinc-900/50 rounded-b-3xl flex justify-between items-center text-xs text-zinc-400">
                <span>Aggregated via GNews API</span>
                <a id="modalLink" href="#" target="_blank" class="text-indigo-500 hover:text-indigo-400 flex items-center gap-1">Read Original <i class="fas fa-external-link-alt text-[10px]"></i></a>
            </div>
        </div>
    </div>

    <script>
        // --- Configuration ---
        // Ensure apiKey is a string and trimmed of whitespace
        let apiKey = (localStorage.getItem('gnews_api_key') || "").trim();
        
        const fallbackPool = [
            { source: "Reuters", title: "Next-Gen Semiconductors Hit Markets", description: "Major breakthroughs in 2nm process technology promise 40% efficiency gains in mobile devices. Leading foundries have announced the mass production of 2nm chips.", url: "#", publishedAt: new Date().toISOString() },
            { source: "TechCrunch", title: "Generative AI Regulation Talks Heat Up", description: "Global leaders convene to discuss standardizing safety protocols for autonomous agents. A new summit in Geneva has brought together tech leaders.", url: "#", publishedAt: new Date().toISOString() },
            { source: "The Verge", title: "Smart Glasses Adoption Soars in Q3", description: "AR wearables are finally seeing mainstream traction thanks to lightweight form factors. Q3 earnings reports show a 200% spike in sales.", url: "#", publishedAt: new Date().toISOString() },
            { source: "Bloomberg", title: "Tech Giants Pivot to Nuclear Energy", description: "Data center power demands drive unprecedented investment in small modular reactors to meet the voracious energy appetite of AI.", url: "#", publishedAt: new Date().toISOString() },
            { source: "Wired", title: "Quantum Encryption Standards Released", description: "NIST finalizes algorithms designed to protect data from future quantum computer attacks. Organizations are urged to begin migration.", url: "#", publishedAt: new Date().toISOString() },
            { source: "Engadget", title: "Foldable Phones Market Matures", description: "Durability concerns fade as new hinge designs rated for 500,000 folds become standard. New dust-proof hinges and ultra-thin glass composites.", url: "#", publishedAt: new Date().toISOString() }
        ];

        // --- DOM Elements ---
        const newsGrid = document.getElementById('newsGrid');
        const countdownEl = document.getElementById('countdown');
        const settingsPanel = document.getElementById('settingsPanel');
        const statusText = document.getElementById('statusText');
        const apiKeyInput = document.getElementById('apiKeyInput');

        // --- Init ---
        apiKeyInput.value = apiKey;

        // --- Timer Logic ---
        function updateTimer() {
            const now = new Date();
            const nextHour = new Date(now);
            nextHour.setHours(now.getHours() + 1, 0, 0, 0);
            
            const diff = nextHour - now;
            
            if (diff <= 0) {
                refreshFeed();
                setTimeout(updateTimer, 2000); // Buffer
                return;
            }

            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            countdownEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            requestAnimationFrame(updateTimer);
        }

        // --- API Logic ---
        async function fetchGNews() {
            if (!apiKey) return null;
            // Fetch top 6 tech news in English
            const url = `https://gnews.io/api/v4/top-headlines?category=technology&lang=en&max=6&apikey=${apiKey}`;
            
            try {
                const response = await fetch(url);
                // Handle HTTP errors specifically
                if (!response.ok) {
                    console.warn(`GNews Error: ${response.status} ${response.statusText}`);
                    return "KEY_ERROR"; 
                }

                const data = await response.json();
                
                if (data.errors) {
                    console.warn("GNews API Error:", data.errors);
                    return "KEY_ERROR";
                }
                
                return data.articles;
            } catch (e) {
                console.error("Fetch failed:", e);
                return null;
            }
        }

        async function refreshFeed() {
            newsGrid.innerHTML = '<div class="col-span-full text-center py-20 text-zinc-500 animate-pulse font-mono text-sm">SYNCING SATELLITES...</div>';
            
            let articles = [];
            
            if (apiKey) {
                const liveData = await fetchGNews();
                
                if (Array.isArray(liveData)) {
                    // Success
                    articles = liveData;
                    setStatus("LIVE: GNEWS API", "green");
                } else if (liveData === "KEY_ERROR") {
                    // Specific API Key or Auth error
                    articles = fallbackPool;
                    setStatus("KEY ERROR - CHECK SETTINGS", "red");
                } else {
                    // Network or unknown error
                    articles = fallbackPool;
                    setStatus("API ERROR - FALLBACK", "orange");
                }
            } else {
                // No key provided
                articles = fallbackPool;
                setStatus("SIMULATION MODE", "indigo");
            }

            renderNews(articles);
        }

        function setStatus(text, color) {
            statusText.textContent = text;
            const parent = statusText.parentElement;
            // Reset base classes
            parent.className = `inline-flex items-center gap-2 mb-4 px-3 py-1 rounded-full border text-xs font-mono transition-colors duration-300`;
            
            if (color === 'green') {
                parent.classList.add('border-green-500/20', 'bg-green-500/10', 'text-green-500');
            } else if (color === 'orange') {
                parent.classList.add('border-orange-500/20', 'bg-orange-500/10', 'text-orange-500');
            } else if (color === 'red') {
                parent.classList.add('border-red-500/20', 'bg-red-500/10', 'text-red-500');
            } else {
                parent.classList.add('border-indigo-500/20', 'bg-indigo-500/5', 'text-indigo-600', 'dark:text-indigo-400');
            }
        }

        function renderNews(articles) {
            newsGrid.innerHTML = '';
            
            articles.forEach((article, index) => {
                // Calculate relative time
                const pubDate = new Date(article.publishedAt || new Date());
                const now = new Date();
                const diffMs = now - pubDate;
                const diffMins = Math.floor(diffMs / 60000);
                const timeString = diffMins < 60 ? `${diffMins} mins ago` : `${Math.floor(diffMins/60)} hours ago`;

                const sourceName = article.source.name || article.source || "Unknown";

                const card = document.createElement('div');
                card.className = "card group relative p-6 rounded-2xl bg-white dark:bg-zinc-900/40 border border-zinc-200 dark:border-white/5 hover:border-zinc-300 dark:hover:border-white/20 transition-all duration-300 hover:-translate-y-1 flex flex-col h-full animate-slide-up cursor-pointer shadow-sm hover:shadow-lg";
                card.style.animationDelay = `${index * 100}ms`;
                
                // Pass full article object to banner function
                card.onclick = () => openBanner(article, timeString, sourceName);

                card.innerHTML = `
                    <div class="absolute inset-0 spotlight opacity-0 group-hover:opacity-100 transition pointer-events-none"></div>
                    <div class="relative z-10 flex flex-col h-full">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center gap-2 text-xs text-zinc-500">
                                <span class="font-bold text-zinc-700 dark:text-zinc-300 flex items-center gap-1">
                                    <i class="fab fa-google text-[10px]"></i> ${sourceName}
                                </span>
                                <span>â€¢</span>
                                <span>${timeString}</span>
                            </div>
                        </div>
                        
                        <h3 class="text-lg font-bold text-zinc-900 dark:text-white mb-2 leading-snug group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors line-clamp-2">
                            ${article.title}
                        </h3>
                        
                        <p class="text-sm text-zinc-600 dark:text-zinc-400 line-clamp-3 leading-relaxed flex-grow">
                            ${article.description || "Click to read more details about this story."}
                        </p>
                    </div>
                `;
                newsGrid.appendChild(card);
            });
        }

        // --- Settings & Modal ---
        function toggleSettings() {
            settingsPanel.classList.toggle('hidden');
        }

        function saveKeyAndRefresh() {
            const key = apiKeyInput.value.trim();
            if (key) {
                localStorage.setItem('gnews_api_key', key);
                apiKey = key;
                toggleSettings();
                refreshFeed();
            } else {
                alert("Please enter a valid API Key");
            }
        }

        // --- Banner Logic ---
        const banner = document.getElementById('articleBanner');
        const backdrop = document.getElementById('bannerBackdrop');
        const bannerContent = document.querySelector('.banner-content');

        function openBanner(article, time, source) {
            document.getElementById('modalSource').textContent = source;
            document.getElementById('bannerTitle').textContent = article.title;
            // Use content if available, otherwise description
            document.getElementById('bannerContent').innerHTML = `<p>${article.content || article.description}</p>`;
            document.getElementById('modalTime').textContent = `Indexed: ${time}`;
            document.getElementById('modalLink').href = article.url;

            banner.classList.remove('hidden');
            setTimeout(() => {
                backdrop.classList.remove('opacity-0');
                bannerContent.classList.remove('scale-95', 'opacity-0');
                bannerContent.classList.add('scale-100', 'opacity-100');
            }, 10);
            document.body.style.overflow = 'hidden';
        }

        window.closeBanner = function() {
            backdrop.classList.add('opacity-0');
            bannerContent.classList.remove('scale-100', 'opacity-100');
            bannerContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                banner.classList.add('hidden');
                document.body.style.overflow = '';
            }, 300);
        }

        // --- Init ---
        refreshFeed();
        requestAnimationFrame(updateTimer);

    </script>
</body>
</html>