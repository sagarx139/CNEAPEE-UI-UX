<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Health+ | Neuro Diagnosis</title>
    
    <!-- Preconnect -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Tailwind & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = { 
            darkMode: 'class', 
            theme: { 
                extend: { 
                    colors: { dark: '#030305' },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.4s ease-out forwards',
                        'pulse-slow': 'pulse 3s infinite'
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
                    }
                } 
            } 
        }

        function toggleTheme() { 
            document.documentElement.classList.toggle('dark'); 
            const isDark = document.documentElement.classList.contains('dark');
            localStorage.setItem('health_theme', isDark ? 'dark' : 'light');
        }

        // Apply theme on load
        if (localStorage.getItem('health_theme') === 'light') {
            document.documentElement.classList.remove('dark');
        }
    </script>
    
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        
        .grid-bg { 
            background-image: linear-gradient(rgba(120,120,120,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(120,120,120,0.05) 1px, transparent 1px); 
            background-size: 30px 30px; 
            mask-image: linear-gradient(black 60%, transparent); 
            -webkit-mask-image: linear-gradient(black 60%, transparent);
        }
        
        .spotlight { background: radial-gradient(400px circle at var(--x) var(--y), rgba(16, 185, 129, 0.1), transparent 40%); }
        html.dark .spotlight { background: radial-gradient(500px circle at var(--x) var(--y), rgba(16, 185, 129, 0.05), transparent 40%); }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(52, 211, 153, 0.3); border-radius: 3px; }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        html.dark .glass-panel {
            background: rgba(10, 10, 12, 0.95);
            border: 1px solid rgba(255,255,255,0.1);
        }
    </style>
</head>
<body class="bg-zinc-50 text-zinc-900 dark:bg-[#030305] dark:text-zinc-300 flex flex-col min-h-screen overflow-x-hidden relative transition-colors duration-300"
      onmousemove="requestAnimationFrame(() => document.querySelectorAll('.card').forEach(c=>{const r=c.getBoundingClientRect();c.style.setProperty('--x',(event.clientX-r.left)+'px');c.style.setProperty('--y',(event.clientY-r.top)+'px')}))">

    <!-- Backgrounds -->
    <div class="fixed inset-0 grid-bg pointer-events-none -z-10"></div>
    <div class="fixed top-0 right-0 w-[600px] h-[500px] bg-emerald-500/10 blur-[120px] rounded-full pointer-events-none -z-10"></div>
    <div class="fixed bottom-0 left-0 w-[500px] h-[500px] bg-indigo-500/5 blur-[120px] rounded-full pointer-events-none -z-10"></div>

    <!-- Navigation -->
    <nav class="fixed top-6 left-0 right-0 z-50 flex justify-center px-4">
        <div class="bg-white dark:bg-zinc-900/90 backdrop-blur-xl border border-zinc-200 dark:border-white/10 rounded-full p-1.5 flex items-center shadow-2xl transition-all duration-300 hover:shadow-emerald-500/10">
            <a href="index.html" class="w-10 h-10 flex items-center justify-center rounded-full text-zinc-500 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-white/10 transition">
                <i class="fas fa-home"></i>
            </a>
            
            <div class="w-px h-4 bg-zinc-300 dark:bg-white/10 mx-2"></div>
            
            <div class="relative group">
                <button class="flex items-center gap-3 px-6 py-2 rounded-full bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 text-sm font-semibold transition cursor-default">
                    <span>Health+ Diagnosis</span>
                    <i class="fas fa-heartbeat text-xs animate-pulse"></i>
                </button>
            </div>
            
            <div class="w-px h-4 bg-zinc-300 dark:bg-white/10 mx-2"></div>
            
            <button onclick="toggleSettings()" class="w-10 h-10 flex items-center justify-center rounded-full text-zinc-500 dark:text-zinc-400 hover:bg-zinc-100 dark:hover:bg-white/10 transition" title="Settings & Integrations">
                <i class="fas fa-cog"></i>
            </button>
        </div>
    </nav>

    <!-- Settings Panel -->
    <div id="settingsPanel" class="fixed top-24 right-0 left-0 mx-auto w-80 glass-panel rounded-2xl shadow-2xl p-5 hidden z-40 transform transition-all animate-fade-in origin-top">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xs font-bold uppercase text-zinc-500 tracking-wider">Configuration</h3>
            <button onclick="toggleSettings()" class="text-zinc-400 hover:text-zinc-900 dark:hover:text-white"><i class="fas fa-times"></i></button>
        </div>
        
        <!-- Data Source Selection -->
        <div class="mb-4">
            <label class="block text-xs text-zinc-400 mb-1.5 font-bold">Primary Data Source Context</label>
            <div class="relative">
                <select id="dataSourceSelect" class="w-full bg-zinc-100 dark:bg-black/50 border border-zinc-200 dark:border-white/10 rounded-lg px-3 py-2 text-xs text-zinc-900 dark:text-white focus:outline-none focus:border-emerald-500 appearance-none">
                    <option value="Neuro 1.1 General">Neuro 1.1 General (Default)</option>
                    
                    <optgroup label="Government & Literature">
                        <option value="PubMed (MEDLINE)">PubMed (E-utilities)</option>
                        <option value="PubMed Central (PMC)">PubMed Central (PMC)</option>
                        <option value="OpenFDA Drugs">OpenFDA Drug API</option>
                        <option value="HealthCare.gov">HealthCare.gov Content</option>
                        <option value="WHO Data Warehouse">WHO/Europe Data Warehouse</option>
                    </optgroup>
                    
                    <optgroup label="General Health Data">
                        <option value="ClinicalTrials.gov">Clinical Trial API</option>
                        <option value="DrugBank">Drug Search API (DrugBank)</option>
                        <option value="OGD India">Open Government Data (India)</option>
                        <option value="FDA NDC Directory">National Drug Code Directory</option>
                    </optgroup>
                    
                    <optgroup label="Wearables & Metrics">
                        <option value="Withings Data">Withings Public API</option>
                        <option value="Biostrap Metrics">Biostrap API</option>
                        <option value="BMI Standards">BMI Calculator Standards</option>
                    </optgroup>
                    
                    <optgroup label="Commercial/Research">
                        <option value="eLife Sciences">eLife Sciences API</option>
                        <option value="Amazon Comprehend Medical">Amazon Comprehend Medical</option>
                        <option value="Google Cloud Healthcare">Google Cloud Healthcare API</option>
                        <option value="Redox EHR">Redox API</option>
                    </optgroup>
                </select>
                <div class="absolute right-3 top-2.5 pointer-events-none text-zinc-400">
                    <i class="fas fa-chevron-down text-xs"></i>
                </div>
            </div>
            <p class="text-[10px] text-zinc-500 mt-1">Sets the retrieval context for AI analysis.</p>
        </div>

        <!-- API Key Input -->
        <div class="mb-4">
            <label class="block text-xs text-zinc-400 mb-1.5 font-bold">Gemini API Key (Optional)</label>
            <input type="password" id="apiKeyInput" placeholder="Uses default if empty" class="w-full bg-zinc-100 dark:bg-black/50 border border-zinc-200 dark:border-white/10 rounded-lg px-3 py-2 text-xs text-zinc-900 dark:text-white focus:outline-none focus:border-emerald-500 mb-1">
        </div>

        <button onclick="saveSettings()" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white text-xs font-bold py-2.5 rounded-lg mb-4 transition shadow-lg shadow-emerald-500/20">
            Save Preferences
        </button>

        <div class="border-t border-zinc-200 dark:border-white/10 pt-4 flex justify-between items-center">
            <span class="text-xs text-zinc-500">Interface Theme</span>
            <button onclick="toggleTheme()" class="text-xs bg-zinc-100 dark:bg-white/10 px-3 py-1.5 rounded-md hover:bg-zinc-200 dark:hover:bg-white/20 transition text-zinc-700 dark:text-zinc-300">Switch Mode</button>
        </div>
    </div>

    <main class="flex-grow pt-32 pb-20 px-4 max-w-7xl mx-auto w-full">
        
        <!-- Hero Search -->
        <div class="flex flex-col items-center justify-center mb-16 animate-fade-in text-center max-w-3xl mx-auto">
            <div class="inline-flex items-center gap-2 mb-6 px-3 py-1 rounded-full border border-emerald-500/20 bg-emerald-500/5 text-emerald-600 dark:text-emerald-400 text-xs font-mono tracking-wider" id="activeContextBadge">
                <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                <span id="activeContextText">NEURO 1.1 ELITE MEDICAL ENGINE</span>
            </div>
            
            <h1 class="text-4xl md:text-6xl font-bold tracking-tight mb-4 text-zinc-900 dark:text-white">
                How are you <span class="text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-500">feeling?</span>
            </h1>
            
            <p class="text-zinc-500 dark:text-zinc-400 mb-10 text-lg">Describe your symptoms or select a condition below.</p>

            <!-- Search Bar -->
            <div class="relative w-full group">
                <div class="absolute inset-0 bg-gradient-to-r from-emerald-500 to-cyan-500 rounded-2xl blur opacity-20 group-hover:opacity-30 transition duration-500"></div>
                <div class="relative flex items-center">
                    <input type="text" id="searchInput" placeholder="e.g., 'I have a headache and stiff neck' or 'Diabetes'" 
                        class="w-full bg-white dark:bg-[#0A0A0C] border border-zinc-200 dark:border-white/10 rounded-2xl py-4 pl-6 pr-14 text-zinc-900 dark:text-white focus:outline-none focus:border-emerald-500/50 shadow-xl transition-all placeholder:text-zinc-400">
                    <button onclick="handleSearch()" class="absolute right-3 p-2 bg-emerald-500 hover:bg-emerald-600 text-white rounded-xl transition shadow-lg">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                <p class="text-xs text-zinc-500 mt-3 text-left ml-2"><i class="fas fa-info-circle mr-1"></i> Powered by Gemini AI. Always consult a doctor for emergencies.</p>
            </div>
        </div>

        <!-- Quick Access Grid -->
        <div class="mb-8 flex items-center justify-between">
            <h2 class="text-xl font-bold text-zinc-900 dark:text-white">Common Conditions</h2>
            <div class="h-px flex-grow bg-zinc-200 dark:bg-white/10 ml-6"></div>
        </div>

        <div id="diseaseGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
            <!-- Grid items injected by JS -->
        </div>

    </main>

    <!-- Detailed Modal -->
    <div id="diseaseModal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-zinc-50/90 dark:bg-black/90 backdrop-blur-md transition-opacity" onclick="closeModal()"></div>
        
        <div class="relative w-full max-w-4xl bg-white dark:bg-[#0A0A0C] border border-zinc-200 dark:border-white/10 rounded-3xl shadow-2xl flex flex-col max-h-[90vh] animate-slide-up overflow-hidden">
            
            <!-- Modal Header -->
            <div class="flex justify-between items-start p-6 md:p-8 border-b border-zinc-100 dark:border-white/5 bg-zinc-50/50 dark:bg-zinc-900/50">
                <div>
                    <div class="flex items-center gap-3 mb-2">
                        <span class="p-2 rounded-lg bg-emerald-500/10 text-emerald-600 dark:text-emerald-400"><i class="fas fa-notes-medical"></i></span>
                        <span id="modalSource" class="text-xs font-bold uppercase tracking-wider text-zinc-500">Neuro Diagnosis</span>
                    </div>
                    <h2 id="modalTitle" class="text-3xl font-bold text-zinc-900 dark:text-white leading-tight"></h2>
                </div>
                <button onclick="closeModal()" class="w-10 h-10 rounded-full bg-zinc-100 dark:bg-white/5 hover:bg-zinc-200 dark:hover:bg-white/10 flex items-center justify-center transition text-zinc-500 dark:text-zinc-400">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Modal Content -->
            <div class="flex-grow overflow-y-auto p-6 md:p-8 custom-scrollbar">
                
                <!-- Brief -->
                <div id="modalBrief" class="text-lg text-zinc-600 dark:text-zinc-300 leading-relaxed mb-8 font-medium"></div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Column 1 -->
                    <div class="space-y-8">
                        <div class="bg-zinc-50 dark:bg-white/5 rounded-2xl p-6 border border-zinc-100 dark:border-white/5">
                            <h3 class="flex items-center gap-2 text-lg font-bold text-zinc-900 dark:text-white mb-4">
                                <i class="fas fa-search-plus text-indigo-500"></i> Symptoms
                            </h3>
                            <ul id="modalSymptoms" class="space-y-2 text-sm text-zinc-600 dark:text-zinc-400 list-disc pl-4 marker:text-indigo-500"></ul>
                        </div>

                        <div class="bg-red-50 dark:bg-red-500/5 rounded-2xl p-6 border border-red-100 dark:border-red-500/10">
                            <h3 class="flex items-center gap-2 text-lg font-bold text-red-700 dark:text-red-400 mb-4">
                                <i class="fas fa-exclamation-triangle"></i> Warning Signs
                            </h3>
                            <ul id="modalWarnings" class="space-y-2 text-sm text-red-900 dark:text-red-200/80 list-disc pl-4 marker:text-red-500"></ul>
                        </div>
                    </div>

                    <!-- Column 2 -->
                    <div class="space-y-8">
                        <div class="bg-emerald-50 dark:bg-emerald-500/5 rounded-2xl p-6 border border-emerald-100 dark:border-emerald-500/10">
                            <h3 class="flex items-center gap-2 text-lg font-bold text-emerald-700 dark:text-emerald-400 mb-4">
                                <i class="fas fa-shield-alt"></i> Prevention & Care
                            </h3>
                            <div class="space-y-4">
                                <div>
                                    <h4 class="text-xs font-bold uppercase text-emerald-600/70 dark:text-emerald-400/50 mb-2">Home Care</h4>
                                    <ul id="modalPrecautions" class="space-y-1 text-sm text-zinc-600 dark:text-zinc-400 list-disc pl-4 marker:text-emerald-500"></ul>
                                </div>
                                <div>
                                    <h4 class="text-xs font-bold uppercase text-emerald-600/70 dark:text-emerald-400/50 mb-2">Prevention</h4>
                                    <ul id="modalPrevention" class="space-y-1 text-sm text-zinc-600 dark:text-zinc-400 list-disc pl-4 marker:text-emerald-500"></ul>
                                </div>
                            </div>
                        </div>

                        <div class="bg-zinc-50 dark:bg-white/5 rounded-2xl p-6 border border-zinc-100 dark:border-white/5">
                            <h3 class="flex items-center gap-2 text-lg font-bold text-zinc-900 dark:text-white mb-4">
                                <i class="fas fa-pills text-purple-500"></i> Treatments
                            </h3>
                            <ul id="modalMedicines" class="space-y-2 text-sm text-zinc-600 dark:text-zinc-400 list-disc pl-4 marker:text-purple-500"></ul>
                        </div>
                    </div>
                </div>

                <!-- Support Tips (Conditional) -->
                <div id="modalSupport" class="mt-8 hidden">
                    <div class="bg-pink-50 dark:bg-pink-500/5 rounded-2xl p-6 border border-pink-100 dark:border-pink-500/10">
                        <h3 class="flex items-center gap-2 text-lg font-bold text-pink-700 dark:text-pink-400 mb-4">
                            <i class="fas fa-heart"></i> Partner Support Tips
                        </h3>
                        <ul id="modalSupportList" class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-zinc-600 dark:text-zinc-400"></ul>
                    </div>
                </div>

            </div>
            
            <!-- Footer -->
            <div class="p-4 border-t border-zinc-100 dark:border-white/5 bg-zinc-50/50 dark:bg-zinc-900/50 text-center">
                <p class="text-[10px] text-zinc-400 max-w-2xl mx-auto">
                    ‚ö†Ô∏è <strong>Disclaimer:</strong> This information is for educational purposes only and generated by Neuro 1.1 AI. It is not medical advice. Consult a professional for diagnosis.
                </p>
            </div>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const DEFAULT_API_KEY = "2877481bf91e69e4b75457258c852780"; 
        
        // --- State ---
        let currentDataSource = localStorage.getItem('health_source') || "Neuro 1.1 General";
        let userApiKey = localStorage.getItem('health_api_key') || "";

        // --- DOM Elements ---
        const grid = document.getElementById('diseaseGrid');
        const modal = document.getElementById('diseaseModal');
        const searchInput = document.getElementById('searchInput');
        const settingsPanel = document.getElementById('settingsPanel');
        const dataSourceSelect = document.getElementById('dataSourceSelect');
        const apiKeyInput = document.getElementById('apiKeyInput');
        const activeContextText = document.getElementById('activeContextText');

        // --- Static Database (Common diseases for offline/quick access) ---
        const diseases = [
            {
                name: "Fever",
                icon: "ü§í",
                brief: "Temporary increase in body temperature, often indicating the body is fighting an infection.",
                symptoms: ["Temp > 100.4¬∞F", "Chills", "Sweating", "Headache", "Fatigue", "Loss of appetite"],
                warnings: ["Fever > 103¬∞F", "Lasts > 3 days", "Difficulty breathing", "Severe headache", "Confusion"],
                precautions: ["Rest", "Hydrate", "Light clothing", "Cool cloth on forehead", "Lukewarm bath"],
                medicines: ["Paracetamol", "Ibuprofen", "ORS for hydration", "Consult pharmacist for dosing"],
                prevention: ["Hand hygiene", "Vaccination", "Avoid sick contacts", "Balanced diet"]
            },
            {
                name: "Body Ache",
                icon: "üí™",
                brief: "Pain or discomfort in muscles and joints, often caused by viral infections or exertion.",
                symptoms: ["Muscle pain", "Joint stiffness", "Fatigue", "Weakness", "Movement pain"],
                warnings: ["Severe persistent pain", "High fever", "Muscle weakness", "Joint swelling"],
                precautions: ["Rest", "Heat/Cold therapy", "Gentle stretching", "Hydration", "Good posture"],
                medicines: ["Paracetamol", "Ibuprofen", "Topical gels", "Muscle relaxants (if prescribed)"],
                prevention: ["Regular exercise", "Warm-up before activity", "Ergonomics", "Hydration"]
            },
            {
                name: "Common Cold",
                icon: "ü§ß",
                brief: "Viral infection of the upper respiratory tract affecting nose and throat.",
                symptoms: ["Runny nose", "Sneezing", "Sore throat", "Cough", "Mild fever"],
                warnings: ["Symptoms > 10 days", "High fever", "Severe sinus pain", "Wheezing"],
                precautions: ["Rest", "Hydrate", "Humidifier", "Warm gargle", "Avoid cold air"],
                medicines: ["Paracetamol", "Antihistamines", "Saline drops", "Cough suppressants", "Lozenges"],
                prevention: ["Wash hands", "Avoid touching face", "Disinfect surfaces", "Boost immunity"]
            },
            {
                name: "Cough",
                icon: "üò∑",
                brief: "Reflex action to clear airways of irritants or mucus.",
                symptoms: ["Dry or wet cough", "Throat irritation", "Chest tightness", "Hoarse voice"],
                warnings: ["Lasts > 3 weeks", "Blood in sputum", "High fever", "Shortness of breath"],
                precautions: ["Hydrate", "Humidifier", "Avoid smoke", "Elevate head sleeping", "Cover mouth"],
                medicines: ["Dextromethorphan (Dry)", "Guaifenesin (Wet)", "Honey", "Lozenges"],
                prevention: ["Avoid smoke", "Vaccination", "Hand hygiene", "Treat allergies"]
            },
            {
                name: "Headache",
                icon: "ü§ï",
                brief: "Pain in head or neck region ranging from mild to severe.",
                symptoms: ["Throbbing pain", "Sensitivity to light", "Nausea", "Dizziness", "Tension"],
                warnings: ["Worst headache of life", "Fever & stiff neck", "Post-injury", "Vision changes"],
                precautions: ["Dark quiet room", "Compresses", "Hydrate", "Relaxation", "Sleep schedule"],
                medicines: ["Paracetamol", "Ibuprofen", "Aspirin", "Sumatriptan (Migraine)", "Balms"],
                prevention: ["Identify triggers", "Regular sleep", "Hydration", "Manage stress", "Limit screens"]
            },
            {
                name: "Nausea",
                icon: "ü§¢",
                brief: "Unpleasant sensation of feeling like you might vomit.",
                symptoms: ["Queasiness", "Salivation", "Sweating", "Dizziness", "Aversion to food"],
                warnings: ["> 24 hours", "Severe abdominal pain", "Dehydration", "Blood in vomit"],
                precautions: ["Small meals", "Avoid odors", "Clear fluids", "Fresh air", "Don't lie flat after eating"],
                medicines: ["Ondansetron (Rx)", "Domperidone", "Ginger", "Antacids", "ORS"],
                prevention: ["Eat slowly", "Avoid triggers", "Hydrate", "Small meals", "Manage stress"]
            },
            {
                name: "Diarrhea",
                icon: "üí©",
                brief: "Frequent loose or watery stools leading to fluid loss.",
                symptoms: ["Watery stools", "Cramps", "Urgency", "Bloating", "Dehydration"],
                warnings: ["> 2 days", "Blood in stool", "High fever", "Severe dehydration", "Severe pain"],
                precautions: ["Hydrate (ORS)", "Bland diet (BRAT)", "Avoid dairy/caffeine", "Rest"],
                medicines: ["ORS", "Zinc", "Probiotics", "Paracetamol", "Antibiotics (if bacterial)"],
                prevention: ["Hand hygiene", "Safe water", "Cook food well", "Wash produce"]
            },
            {
                name: "Vomiting",
                icon: "ü§Æ",
                brief: "Forceful expulsion of stomach contents.",
                symptoms: ["Nausea", "Expulsion", "Abdominal pain", "Sweating", "Weakness"],
                warnings: ["> 24 hours", "Blood in vomit", "Severe pain", "Dehydration", "Head injury"],
                precautions: ["Clear fluids", "No solid food initially", "Rest", "Bland diet later"],
                medicines: ["ORS", "Antiemetics", "Probiotics"],
                prevention: ["Food hygiene", "Avoid overeating", "Wash hands"]
            },
            {
                name: "Itching",
                icon: "üî•",
                brief: "Uncomfortable sensation provoking the urge to scratch.",
                symptoms: ["Urge to scratch", "Redness", "Dry skin", "Bumps", "Blisters"],
                warnings: ["> 2 weeks", "Affects sleep", "Jaundice signs", "Infection signs", "Breathing difficulty"],
                precautions: ["Moisturize", "Cool compress", "Loose clothing", "Mild soap", "Trim nails"],
                medicines: ["Antihistamines", "Calamine", "Moisturizers", "Steroid creams (short term)"],
                prevention: ["Skin hygiene", "Avoid allergens", "Sunscreen", "Hydrate skin"]
            },
            {
                name: "Diabetes",
                icon: "ü©∫",
                brief: "Chronic condition affecting blood sugar regulation.",
                symptoms: ["Thirst", "Urination", "Hunger", "Weight loss", "Fatigue", "Blurry vision"],
                warnings: ["Extreme sugar levels", "Confusion", "Abdominal pain", "Infection signs", "Foot sores"],
                precautions: ["Monitor sugar", "Diet & Exercise", "Foot care", "No smoking", "Checkups"],
                medicines: ["Metformin", "Insulin", "Statins", "BP meds", "Consult doctor"],
                prevention: ["Healthy weight", "Exercise", "Low sugar diet", "Regular screenings"]
            },
            {
                name: "Hypertension",
                icon: "üíì",
                brief: "High blood pressure increasing heart risk.",
                symptoms: ["Often none", "Headaches", "Dizziness", "Shortness of breath"],
                warnings: ["Severe headache", "Chest pain", "Vision change", "Weakness", "Speech difficulty"],
                precautions: ["Monitor BP", "Low salt", "Weight control", "Exercise", "Limit alcohol"],
                medicines: ["ACE inhibitors", "Beta-blockers", "Diuretics", "Calcium channel blockers"],
                prevention: ["Low salt diet", "Exercise", "Weight control", "Stress management"]
            },
            {
                name: "Menstrual Issues",
                icon: "üå∏",
                brief: "Irregularities or pain associated with menstrual cycle.",
                symptoms: ["Irregularity", "Heavy bleeding", "Cramps", "Mood changes", "Fatigue"],
                warnings: ["Bleeding > 7 days", "Large clots", "Severe pain", "Fever", "Missed periods"],
                precautions: ["Track cycle", "Heat therapy", "Hydrate", "Exercise", "Iron rich diet"],
                medicines: ["Pain relievers", "Hormonal contraceptives", "Iron supplements"],
                prevention: ["Healthy lifestyle", "Stress management", "Regular checkups"],
                supportTipsForPartners: ["Be understanding", "Help with chores", "Offer comfort foods", "Heating pads", "Patience with mood", "Chocolate & snacks"]
            },
            {
                name: "Anxiety",
                icon: "üò∞",
                brief: "Excessive worry or fear interfering with daily life.",
                symptoms: ["Worry", "Restlessness", "Rapid heart", "Sweating", "Sleep issues"],
                warnings: ["Panic attacks", "Chest pain", "Self-harm thoughts", "Substance abuse"],
                precautions: ["Relaxation", "Limit caffeine", "Sleep schedule", "Exercise", "Counseling"],
                medicines: ["Therapy (CBT)", "SSRIs", "Anxiolytics (Rx)", "Lifestyle changes"],
                prevention: ["Coping strategies", "Mindfulness", "Exercise", "Social support"]
            }
        ];

        // --- Initialization ---
        function init() {
            // Restore Settings
            dataSourceSelect.value = currentDataSource;
            apiKeyInput.value = userApiKey;
            updateStatusBadge();
            
            // Render Grid
            renderGrid();
        }

        function renderGrid() {
            grid.innerHTML = diseases.map((d, i) => `
                <button onclick="openStaticModal(${i})" class="card group relative p-6 rounded-2xl bg-white dark:bg-zinc-900/40 border border-zinc-200 dark:border-white/5 hover:border-emerald-500/50 dark:hover:border-emerald-500/50 transition-all duration-300 hover:-translate-y-1 flex flex-col items-center text-center animate-slide-up h-full">
                    <div class="absolute inset-0 spotlight opacity-0 group-hover:opacity-100 transition pointer-events-none"></div>
                    <div class="text-4xl mb-4 group-hover:scale-110 transition-transform">${d.icon}</div>
                    <div class="font-bold text-zinc-900 dark:text-white mb-2">${d.name}</div>
                    <div class="text-xs text-zinc-500 dark:text-zinc-400 line-clamp-2">${d.brief}</div>
                </button>
            `).join('');
        }

        // --- Settings Logic ---
        function toggleSettings() {
            settingsPanel.classList.toggle('hidden');
        }

        function saveSettings() {
            // Save Source
            currentDataSource = dataSourceSelect.value;
            localStorage.setItem('health_source', currentDataSource);
            
            // Save API Key
            userApiKey = apiKeyInput.value.trim();
            if(userApiKey) {
                localStorage.setItem('health_api_key', userApiKey);
            } else {
                localStorage.removeItem('health_api_key');
            }

            updateStatusBadge();
            toggleSettings();
        }

        function updateStatusBadge() {
            let label = "NEURO 1.1 ELITE";
            if(currentDataSource !== "Neuro 1.1 General") {
                label = `CONTEXT: ${currentDataSource.toUpperCase()}`;
            }
            activeContextText.textContent = label;
        }

        // --- Search & AI Logic ---
        async function handleSearch() {
            const query = searchInput.value.trim();
            if (!query) return;

            // Check local DB first if general context
            if (currentDataSource === "Neuro 1.1 General") {
                const localMatch = diseases.find(d => d.name.toLowerCase() === query.toLowerCase());
                if (localMatch) {
                    openStaticModal(diseases.indexOf(localMatch));
                    return;
                }
            }

            // Call Gemini API
            showLoadingModal();
            const activeKey = userApiKey || DEFAULT_API_KEY;
            
            const prompt = `Act as a professional medical assistant. Analyze: "${query}". 
                            
                            CONTEXT: The user has selected "${currentDataSource}" as their preferred data source. 
                            Please prioritize information, guidelines, or research styles relevant to this source if applicable.
                            
                            Return a valid JSON object with these keys:
                            {
                                "name": "Medical Name of Condition",
                                "brief": "2 sentence summary (referencing ${currentDataSource} if relevant)",
                                "symptoms": ["List 5-6 symptoms"],
                                "warnings": ["List 4-5 warning signs"],
                                "precautions": ["List 5 home care steps"],
                                "medicines": ["List common generic treatments/drug classes"],
                                "prevention": ["List 4 prevention tips"]
                            }
                            Do not include markdown code blocks. Just raw JSON.`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${activeKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });

                const data = await response.json();
                
                if (!data.candidates || data.candidates.length === 0) {
                     throw new Error("No response content generated.");
                }

                const text = data.candidates[0].content.parts[0].text.replace(/```json|```/g, '').trim();
                const aiResult = JSON.parse(text);
                
                openDynamicModal(aiResult);

            } catch (error) {
                console.error(error);
                alert("Analysis failed. Please try again or check connection.");
                closeModal();
            }
        }

        // --- Modal Logic ---
        function openStaticModal(index) {
            const d = diseases[index];
            populateModal(d, "Neuro Database");
        }

        function openDynamicModal(data) {
            populateModal(data, `Neuro AI (${currentDataSource})`);
        }

        function populateModal(data, source) {
            document.getElementById('modalTitle').textContent = data.name;
            document.getElementById('modalBrief').textContent = data.brief;
            document.getElementById('modalSource').textContent = source;

            const listBuilder = (items) => items.map(i => `<li>${i}</li>`).join('');

            document.getElementById('modalSymptoms').innerHTML = listBuilder(data.symptoms);
            document.getElementById('modalWarnings').innerHTML = listBuilder(data.warnings);
            document.getElementById('modalPrecautions').innerHTML = listBuilder(data.precautions);
            document.getElementById('modalMedicines').innerHTML = listBuilder(data.medicines);
            document.getElementById('modalPrevention').innerHTML = listBuilder(data.prevention);

            const supportDiv = document.getElementById('modalSupport');
            if (data.supportTipsForPartners) {
                document.getElementById('modalSupportList').innerHTML = listBuilder(data.supportTipsForPartners);
                supportDiv.classList.remove('hidden');
            } else {
                supportDiv.classList.add('hidden');
            }

            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function showLoadingModal() {
            document.getElementById('modalTitle').textContent = "Analyzing...";
            document.getElementById('modalBrief').textContent = `Neuro 1.1 is processing via ${currentDataSource}...`;
            ['modalSymptoms', 'modalWarnings', 'modalPrecautions', 'modalMedicines', 'modalPrevention'].forEach(id => {
                document.getElementById(id).innerHTML = '<li class="animate-pulse bg-zinc-200 dark:bg-white/10 h-4 w-3/4 rounded"></li><li class="animate-pulse bg-zinc-200 dark:bg-white/10 h-4 w-1/2 rounded"></li>';
            });
            document.getElementById('modalSupport').classList.add('hidden');
            modal.classList.remove('hidden');
        }

        function closeModal() {
            modal.classList.add('hidden');
            document.body.style.overflow = '';
        }

        // --- Event Listeners ---
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleSearch();
        });

        // Initialize App
        init();

    </script>
</body>
</html>

